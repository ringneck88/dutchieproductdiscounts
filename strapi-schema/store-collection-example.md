# Store Collection Type Setup

This document explains how to set up or modify your existing `store` collection type in Strapi to include the Dutchie API key.

## Required Fields in Store Collection

Your store collection type should have the following fields:

### Essential Fields:
1. **id** - Auto-generated by Strapi
2. **name** - Text (Short text) - Store name
3. **dutchieApiKey** - Text (Short text) - **REQUIRED** - Dutchie API key for this store
4. **dutchieRetailerId** - Text (Short text) - **REQUIRED** - Dutchie retailer ID for this store
5. **location** - Text (Short text) - Optional - Store location/address
6. **isActive** - Boolean - Default: true - Whether to sync this store

### Optional Fields:
- **storeCode** - Text (Short text) - Internal store code
- **city** - Text (Short text) - City
- **state** - Text (Short text) - State
- **timezone** - Text (Short text) - Store timezone

## Example Store Collection Schema

If you're creating a new store collection type, here's the schema:

```json
{
  "kind": "collectionType",
  "collectionName": "stores",
  "info": {
    "singularName": "store",
    "pluralName": "stores",
    "displayName": "Store",
    "description": "Store locations with Dutchie API credentials"
  },
  "options": {
    "draftAndPublish": false
  },
  "pluginOptions": {},
  "attributes": {
    "name": {
      "type": "string",
      "required": true
    },
    "dutchieApiKey": {
      "type": "string",
      "required": true,
      "private": true
    },
    "dutchieRetailerId": {
      "type": "string",
      "required": true
    },
    "location": {
      "type": "string"
    },
    "isActive": {
      "type": "boolean",
      "default": true
    },
    "city": {
      "type": "string"
    },
    "state": {
      "type": "string"
    },
    "storeCode": {
      "type": "string"
    },
    "timezone": {
      "type": "string"
    }
  }
}
```

## Adding to Existing Store Collection

If you already have a `store` collection type in your mintdeals Strapi:

1. Go to **Content-Type Builder** in Strapi admin
2. Find and edit your **Store** collection type
3. Add these fields if they don't exist:
   - **dutchieApiKey** - Text (Short text) - Required - Set as Private
   - **dutchieRetailerId** - Text (Short text) - Required
   - **isActive** - Boolean - Default: true

4. Click **Save** and wait for Strapi to restart

## Security Note

**IMPORTANT**: The `dutchieApiKey` field should be marked as **private** to prevent it from being exposed in API responses to unauthorized users.

To set a field as private:
1. In Content-Type Builder, click on the field
2. Click **Advanced Settings** tab
3. Check **Private field** checkbox
4. Save

## API Permissions for Sync Tool

The sync tool needs to be able to read stores with their API keys. Set up permissions:

1. Go to **Settings** → **Users & Permissions plugin** → **Roles**
2. Create a new role called "Dutchie Sync" or edit an existing API role
3. Under **Store** permissions, enable:
   - `find` (to get all stores)
   - `findOne` (to get a specific store)
4. Generate an API token with this role
5. Use this token as `STRAPI_API_TOKEN` in your `.env` file

## Example Store Data

Here's what your store entries might look like:

### Store 1:
- **name**: "Downtown Location"
- **dutchieApiKey**: "sk_live_abc123..."
- **dutchieRetailerId**: "retailer_001"
- **location**: "123 Main St, City, State"
- **isActive**: true
- **city**: "Denver"
- **state**: "CO"

### Store 2:
- **name**: "Westside Location"
- **dutchieApiKey**: "sk_live_xyz789..."
- **dutchieRetailerId**: "retailer_002"
- **location**: "456 West Ave, City, State"
- **isActive**: true
- **city**: "Denver"
- **state**: "CO"

## Testing Store Setup

After setting up your stores, you can test the API:

```bash
curl -X GET "http://localhost:1337/api/stores" \
  -H "Authorization: Bearer YOUR_STRAPI_API_TOKEN"
```

This should return all your stores (API keys will be hidden if marked private, but the sync tool with proper permissions can access them).

## Notes

- Keep `dutchieApiKey` private and secure
- Set `isActive: false` for stores you want to temporarily skip during sync
- The sync tool will loop through all stores where `isActive: true`
- Each store can have different products and discounts
